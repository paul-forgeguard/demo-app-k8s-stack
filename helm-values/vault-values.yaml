# Vault Helm Values for vx-home single-node cluster
# Chart: hashicorp/vault
# Mode: Standalone (not HA)
# Storage: Ceph RBD via ceph-rbd StorageClass

global:
  enabled: true
  tlsDisable: true  # Vault listener has tls_disable=1, probes must use HTTP

injector:
  enabled: true
  replicas: 1

  # Resource limits for injector
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 250m

  # Webhook configuration
  webhook:
    failurePolicy: Ignore
    matchPolicy: Exact
    timeoutSeconds: 30

server:
  # Standalone mode (single node)
  standalone:
    enabled: true
    config: |
      ui = true

      listener "tcp" {
        tls_disable = 1
        address = "[::]:8200"
        cluster_address = "[::]:8201"
      }

      storage "file" {
        path = "/vault/data"
      }

  # Resource limits
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  # Persistent storage using Ceph RBD
  dataStorage:
    enabled: true
    size: 10Gi
    storageClass: ceph-rbd
    accessMode: ReadWriteOnce

  # Audit logs storage (optional - enable if needed)
  auditStorage:
    enabled: false
    size: 5Gi
    storageClass: ceph-rbd
    accessMode: ReadWriteOnce

  # Readiness/Liveness probes
  readinessProbe:
    enabled: true
    path: "/v1/sys/health?standbyok=true&sealedcode=204&uninitcode=204"

  livenessProbe:
    enabled: true
    path: "/v1/sys/health?standbyok=true"
    initialDelaySeconds: 60

  # Service configuration
  service:
    enabled: true
    type: ClusterIP
    port: 8200
    targetPort: 8200

  # Ingress for UI access
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - host: vt.adm.vx.home
        paths:
          - /
    tls:
      - secretName: vault-tls
        hosts:
          - vt.adm.vx.home
    annotations:
      cert-manager.io/cluster-issuer: vx-home-ca-issuer
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"

  # Extra environment variables
  extraEnvironmentVars:
    VAULT_LOG_LEVEL: info

# UI configuration
ui:
  enabled: true
  serviceType: ClusterIP
  externalPort: 8200

# CSI provider (disabled - using Agent Injector instead)
csi:
  enabled: false

# Server HA configuration (disabled for standalone)
ha:
  enabled: false
