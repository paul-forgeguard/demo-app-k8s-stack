apiVersion: apps/v1
kind: Deployment
metadata:
  name: openwebui
spec:
  template:
    spec:
      securityContext:
        fsGroup: 1000
      # Spread pods across nodes for HA
      topologySpreadConstraints:
      - maxSkew: 1
        topologyKey: kubernetes.io/hostname
        whenUnsatisfiable: ScheduleAnyway
        labelSelector:
          matchLabels:
            app: openwebui
      initContainers:
      - name: fix-permissions
        image: busybox:1.36
        command: ['sh', '-c', 'chown -R 1000:1000 /app/backend/data']
        securityContext:
          runAsUser: 0
        volumeMounts:
        - name: data
          mountPath: /app/backend/data
