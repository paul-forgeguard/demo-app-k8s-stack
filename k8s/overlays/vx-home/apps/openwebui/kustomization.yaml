apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ai

resources:
  - ../../../../base/openwebui

commonLabels:
  app.kubernetes.io/part-of: vx-home-ai-stack

patches:
  # K8s Secret environment variables (until Vault integration is complete)
  - path: patches/secrets-env.yaml
    target:
      kind: Deployment
      name: openwebui
  # Storage class for PVC
  - path: patches/storage-ceph.yaml
    target:
      kind: PersistentVolumeClaim
      name: openwebui-data
  # vx-home specific config
  - path: patches/config.yaml
    target:
      kind: Deployment
      name: openwebui
  # fsGroup + initContainer for CephFS permissions (openwebui runs as UID 1000)
  - path: patches/security-context.yaml
    target:
      kind: Deployment
      name: openwebui
  # Ingress with TLS and vx-home hostname
  - path: patches/ingress.yaml
    target:
      kind: Ingress
      name: openwebui
  # TODO: Re-enable when Vault Agent file-to-env integration is complete
  # - path: patches/vault-annotations.yaml
  #   target:
  #     kind: Deployment
  #     name: openwebui
