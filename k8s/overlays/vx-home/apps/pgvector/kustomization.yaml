apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ai

resources:
  - ../../../../base/pgvector

commonLabels:
  app.kubernetes.io/part-of: vx-home-ai-stack

patches:
  # K8s Secret environment variables (until Vault integration is complete)
  - path: patches/secrets-env.yaml
    target:
      kind: StatefulSet
      name: pgvector
  # Storage class for volumeClaimTemplate
  - path: patches/storage-ceph.yaml
    target:
      kind: StatefulSet
      name: pgvector
  # fsGroup + initContainer for Ceph RBD permissions (postgres runs as UID 999)
  - path: patches/security-context.yaml
    target:
      kind: StatefulSet
      name: pgvector
  # TODO: Re-enable when Vault Agent file-to-env integration is complete
  # - path: patches/vault-annotations.yaml
  #   target:
  #     kind: StatefulSet
  #     name: pgvector
